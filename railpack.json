{
  "$schema": "https://schema.railpack.com",
  "buildAptPackages": [
    "python3-dev",
    "python3-pip", 
    "build-essential",
    "libgl1-mesa-dev",
    "libglib2.0-dev",
    "libegl1-mesa-dev",
    "libglu1-mesa-dev",
    "mesa-common-dev",
    "libglfw3-dev",
    "libxrender-dev",
    "libavcodec-dev",
    "libavformat-dev",
    "libswscale-dev",
    "libjpeg-dev",
    "libpng-dev",
    "libtiff-dev",
    "libwebp-dev",
    "libopenjp2-7-dev"
  ],
  "packages": {
    "python": "3.11"
  },
  "steps": {
    "install": {
      "inputs": [
        {
          "local": true,
          "include": ["requirements.txt"]
        }
      ],
      "commands": [
        "pip install -r requirements.txt"
      ]
    }
  },
  "deploy": {
    "startCommand": "gunicorn --bind 0.0.0.0:$PORT app:app",
    "variables": {
      "QT_QPA_PLATFORM": "offscreen",
      "DISPLAY": ":99",
      "OPENCV_IO_ENABLE_OPENEXR": "1",
      "ULTRALYTICS_SETTINGS": "{\"runs_dir\": \"/tmp\", \"datasets_dir\": \"/tmp\", \"weights_dir\": \"/tmp\"}",
      "LD_LIBRARY_PATH": "/usr/lib/x86_64-linux-gnu:/usr/lib/x86_64-linux-gnu/mesa:/usr/lib"
    }
  }
}